---
title: 'Visualizing Data Part 5: Line Charts'
author: "Chris Kozak"
date: "October 22, 2017"
output: html_document
---

<script src="/ck650.netlify.com/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/ck650.netlify.com/rmarkdown-libs/d3/d3.min.js"></script>
<script src="/ck650.netlify.com/rmarkdown-libs/d3-lasso/d3-lasso.min.js"></script>
<link href="/ck650.netlify.com/rmarkdown-libs/ggiraph/styles.css" rel="stylesheet" />
<script src="/ck650.netlify.com/rmarkdown-libs/ggiraph-binding/ggiraph.js"></script>
<script src="/ck650.netlify.com/rmarkdown-libs/uide7e00948e21511e79e9c9dde48353b57/scripts_uide7e00948e21511e79e9c9dde48353b57.js"></script>


<pre class="r"><code>library(Lahman) #a comprehensive dataset of MLB statistics
library(nflscrapR) #contains NFL data and a built-in API for scraping the most recent data
library(dplyr) #package for querying data
library(ggplot2) #one of the best packages for data visualization
library(ggiraph) #extension that makes ggplot2 graphs interactive</code></pre>
<div id="line-charts" class="section level2">
<h2>Line charts</h2>
<p>Next, we want to create a time-series chart of Aaron Rodgers’ touchdowns per season, but this could be very difficult since Aaron Rodgers’ data is spread out across multiple tables in the nflscrapR package, each table representing a different season. The <strong>playerstats09</strong> table has his stats from the 2009 season, <strong>playerstats10</strong> has his stats from 2010, and so on. To get all of the data for Aaron Rodgers’, we will have to create a <em>loop</em> – a block of code that essentially repeats itself several times over. This loop will iterate through each of the tables of data, pull only the rows for Aaron Rodgers, then bind – or add – those rows to an existing dataframe.</p>
<p>We’ll start by using dplyr to filter his stats from only the 2009 season.</p>
<pre class="r"><code>Rodgers_stats &lt;- playerstats09 %&gt;% #this establishes a dataframe from playerstats09 that will be used in the upcoming loop
  filter(name==&quot;A.Rodgers&quot;)</code></pre>
<p>Now, we’ll use the following for loop to iterate through all of the data from 2010 to 2016:</p>
<pre class="r"><code>for(i in seq(from = 10, to = 16)) { #i will iterate as 10, 11, 12 ... 16
  
  k &lt;- paste(&quot;playerstats&quot;,i,sep=&quot;&quot;) #this will add i onto the &quot;playerstats&quot; string, for example, making playstersi into playerstats10 on the first iteration
  playerstatsi &lt;- get(k) #the get function converts a string (&quot;playerstats10&quot;) into an object (playerstats10) that R will recognize
  
  Rodgers_year &lt;- playerstatsi %&gt;%
    filter(name==&quot;A.Rodgers&quot;)  #this takes our playerstatsi object and selects only the rows with A.Rodgers&#39; name
  
  Rodgers_stats &lt;- rbind(Rodgers_stats, Rodgers_year) #add the rows from Rodgers_year to the existing Rodgers_stats dataframe, which we created before running this loop
  #cat(&quot;Pulled &quot;, dim(Rodgers_year)[1], &quot; rows of data from &quot;, k, &quot;. Rodgers_stats dataframe is now &quot;, dim(Rodgers_stats)[1],&quot; rows long...\n&quot;, sep=&quot;&quot;) #This line would will tell the user what the loop is doing as it is doing it. It&#39;s useful when running the code itself, but since we&#39;re posting this to to a static Web site, we&#39;ll comment it out.
}</code></pre>
<p>With the hard part out of the way, we can adapt following code to make a line chart of Aaron Rodgers’ touchdown data.</p>
<pre class="r"><code>df &lt;- Rodgers_stats%&gt;%
  group_by(Season)%&gt;%
  summarize(season_TDs=sum(pass.tds+rushtds))

g &lt;- ggplot()+
  geom_line(data=df, aes(x=Season, y=season_TDs))+
  ggtitle(&quot;Aaron Rodgers&#39; TDs by year&quot;)+
  geom_point_interactive(data=df, aes(x=Season, y=season_TDs,tooltip=season_TDs))+
  ylab(&quot;Touchdown Passes&quot;)

ggiraph(code=print(g), hover_css=&quot;fill:white;stroke:red&quot;)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="ggiraph html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"html":"<div id='uide7e00948e21511e79e9c9dde48353b57' class='ggiraph-container' ><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" id=\"svg_1\" viewBox=\"0 0 432.00 432.00\" class=\"svg-responsive-container\">\n  <g>\n    <defs>\n      <clipPath id=\"cl1_0\">\n        <rect x=\"0.00\" y=\"432.00\" width=\"0.00\" height=\"0.00\"/>\n      <\/clipPath>\n    <\/defs>\n    <rect x=\"0.00\" y=\"0.00\" width=\"432.00\" height=\"432.00\" id=\"1\" clip-path=\"url(#cl1_0)\" fill=\"#FFFFFF\" fill-opacity=\"1\" stroke-width=\"0.75\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <defs>\n      <clipPath id=\"cl1_1\">\n        <rect x=\"0.00\" y=\"0.00\" width=\"432.00\" height=\"432.00\"/>\n      <\/clipPath>\n    <\/defs>\n    <rect x=\"0.00\" y=\"0.00\" width=\"432.00\" height=\"432.00\" id=\"2\" clip-path=\"url(#cl1_1)\" fill=\"#FFFFFF\" fill-opacity=\"1\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <defs>\n      <clipPath id=\"cl1_2\">\n        <rect x=\"33.92\" y=\"23.90\" width=\"392.60\" height=\"377.76\"/>\n      <\/clipPath>\n    <\/defs>\n    <rect x=\"33.92\" y=\"23.90\" width=\"392.60\" height=\"377.76\" id=\"3\" clip-path=\"url(#cl1_2)\" fill=\"#EBEBEB\" fill-opacity=\"1\" stroke=\"none\"/>\n    <polyline points=\"33.92,295.86 426.52,295.86\" id=\"4\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"33.92,185.08 426.52,185.08\" id=\"5\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"33.92,74.30 426.52,74.30\" id=\"6\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"51.76,401.66 51.76,23.90\" id=\"7\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"153.74,401.66 153.74,23.90\" id=\"8\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"255.71,401.66 255.71,23.90\" id=\"9\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"357.69,401.66 357.69,23.90\" id=\"10\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"0.533489\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"33.92,351.25 426.52,351.25\" id=\"11\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"33.92,240.47 426.52,240.47\" id=\"12\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"33.92,129.69 426.52,129.69\" id=\"13\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"102.75,401.66 102.75,23.90\" id=\"14\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"204.72,401.66 204.72,23.90\" id=\"15\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"306.70,401.66 306.70,23.90\" id=\"16\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"408.67,401.66 408.67,23.90\" id=\"17\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#FFFFFF\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"51.76,185.08 102.75,218.32 153.74,41.07 204.72,118.61 255.71,384.49 306.70,129.69 357.69,218.32 408.67,85.38\" id=\"18\" clip-path=\"url(#cl1_2)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <circle cx=\"51.76\" cy=\"185.08\" r=\"1.47pt\" id=\"19\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"102.75\" cy=\"218.32\" r=\"1.47pt\" id=\"20\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"153.74\" cy=\"41.07\" r=\"1.47pt\" id=\"21\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"204.72\" cy=\"118.61\" r=\"1.47pt\" id=\"22\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"255.71\" cy=\"384.49\" r=\"1.47pt\" id=\"23\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"306.70\" cy=\"129.69\" r=\"1.47pt\" id=\"24\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"357.69\" cy=\"218.32\" r=\"1.47pt\" id=\"25\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <circle cx=\"408.67\" cy=\"85.38\" r=\"1.47pt\" id=\"26\" clip-path=\"url(#cl1_2)\" fill=\"#000000\" fill-opacity=\"1\" stroke-width=\"0.708661\" stroke=\"#000000\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"round\"/>\n    <defs>\n      <clipPath id=\"cl1_3\">\n        <rect x=\"0.00\" y=\"0.00\" width=\"432.00\" height=\"432.00\"/>\n      <\/clipPath>\n    <\/defs>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"18.97\" y=\"354.47\" id=\"27\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">20<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"18.97\" y=\"243.69\" id=\"28\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">30<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"18.97\" y=\"132.91\" id=\"29\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">40<\/text>\n    <\/g>\n    <polyline points=\"31.18,351.25 33.92,351.25\" id=\"30\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"31.18,240.47 33.92,240.47\" id=\"31\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"31.18,129.69 33.92,129.69\" id=\"32\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"102.75,404.40 102.75,401.66\" id=\"33\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"204.72,404.40 204.72,401.66\" id=\"34\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"306.70,404.40 306.70,401.66\" id=\"35\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <polyline points=\"408.67,404.40 408.67,401.66\" id=\"36\" clip-path=\"url(#cl1_3)\" fill=\"none\" stroke-width=\"1.06698\" stroke=\"#333333\" stroke-opacity=\"1\" stroke-linejoin=\"round\" stroke-linecap=\"butt\"/>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"92.74\" y=\"413.03\" id=\"37\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">2010<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"194.71\" y=\"413.03\" id=\"38\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">2012<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"296.69\" y=\"413.03\" id=\"39\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">2014<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"398.66\" y=\"413.03\" id=\"40\" font-size=\"6.60pt\" fill=\"#4D4D4D\" fill-opacity=\"1\" font-family=\"Arial\">2016<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"211.56\" y=\"426.38\" id=\"41\" font-size=\"8.25pt\" font-family=\"Arial\">Season<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text transform=\"translate(13.35,260.78) rotate(-90)\" id=\"42\" font-size=\"8.25pt\" font-family=\"Arial\">Touchdown Passes<\/text>\n    <\/g>\n    <g clip-path=\"url(#cl1_3)\">\n      <text x=\"33.92\" y=\"14.79\" id=\"43\" font-size=\"9.90pt\" font-family=\"Arial\">Aaron Rodgers' TDs by year<\/text>\n    <\/g>\n  <\/g>\n<\/svg>\n<div class='ggiraph-toolbar'><div class='ggiraph-toolbar-block shinyonly'><a class='ggiraph-toolbar-icon neutral' title='lasso selection' href='javascript:lasso_on(\"uide7e00948e21511e79e9c9dde48353b57\", true, \"array_selected_uide7e00948e21511e79e9c9dde48353b57\", \"clicked_uide7e00948e21511e79e9c9dde48353b57\");'><svg width='1.5em' height='1.5em' viewBox='0 0 230 230'><g><ellipse ry='65.5' rx='86.5' cy='94' cx='115.5' stroke-width='20' fill='transparent'/><ellipse ry='11.500001' rx='10.5' cy='153' cx='91.5' stroke-width='20' fill='transparent'/><line y2='210.5' x2='105' y1='164.5' x1='96' stroke-width='20'/><\/g><\/svg><\/a><a class='ggiraph-toolbar-icon drop' title='lasso anti-selection' href='javascript:lasso_on(\"uide7e00948e21511e79e9c9dde48353b57\", false, \"array_selected_uide7e00948e21511e79e9c9dde48353b57\", \"clicked_uide7e00948e21511e79e9c9dde48353b57\");'><svg width='1.5em' height='1.5em' viewBox='0 0 230 230'><g><ellipse ry='65.5' rx='86.5' cy='94' cx='115.5' stroke-width='20' fill='transparent'/><ellipse ry='11.500001' rx='10.5' cy='153' cx='91.5' stroke-width='20' fill='transparent'/><line y2='210.5' x2='105' y1='164.5' x1='96' stroke-width='20'/><\/g><\/svg><\/a><\/div><\/div><style>div.tooltip_uide7e00948e21511e79e9c9dde48353b57 {position:absolute;pointer-events:none;z-index:999;padding:5px;background:black;color:white;border-radius:2px 2px 2px 2px;}\n.cl_data_id_uide7e00948e21511e79e9c9dde48353b57:{}.cl_data_id_uide7e00948e21511e79e9c9dde48353b57:hover{fill:white;stroke:red}\n.clicked_uide7e00948e21511e79e9c9dde48353b57{fill:white;stroke:red}<\/style><\/div>","uid":"uide7e00948e21511e79e9c9dde48353b57","funname":"init_prop_uide7e00948e21511e79e9c9dde48353b57","sel_array_name":"array_selected_uide7e00948e21511e79e9c9dde48353b57","selected_class":"clicked_uide7e00948e21511e79e9c9dde48353b57","tooltip_opacity":0.9,"tooltip_offx":10,"tooltip_offy":0,"zoom_max":1,"use_wh":false,"width":"80%","selection_type":"multiple","flexdashboard":false},"evals":[],"jsHooks":[]}</script>
<p>The chart showed that Rodgers posted an unusually low number of touchdown passes in 2013: only 17. And why might that be? To find out, let’s run another dplyr function to show us the number of games he played per regular season. Note that this is almost the exact same as the dplyr function above.</p>
<pre class="r"><code>df &lt;- Rodgers_stats %&gt;% 
  group_by(Season) %&gt;% 
  summarize(games_per_season=sum(games))</code></pre>
<p>Note that this is almost the same as dplyr function above. The only change we made was to summarize by “games” – as in the number of games that Rodgers played in – rather than <strong>“pass.tds+rushtds”</strong>. Now, let’s take a look at the dataframe:</p>
<pre class="r"><code>df</code></pre>
<pre><code>## # A tibble: 8 x 2
##   Season games_per_season
##    &lt;dbl&gt;            &lt;dbl&gt;
## 1   2009               16
## 2   2010               15
## 3   2011               15
## 4   2012               16
## 5   2013                9
## 6   2014               16
## 7   2015               16
## 8   2016               16</code></pre>
<p>Just as expected, Rodgers posted a lower number of passing touchdowns in the 2013 season because he was out for almost half the season. Coincidentally, he was out due to a broken clavicle – the same injury he has now in the 2017 season.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>Hopefully, this series of posts helped illustrate for new R users how ggplot’s syntax and visualizations differ from base R’s graphics package, as well as how to use the basic and intermediate features of dplyr.</p>
</div>
